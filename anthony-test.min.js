//MediaMath VPAID Wrapper v1.0.0
//Copyright 2017 MediaMath All Rights Reserved
var __IASVANS=function(q){var k={now:function(){return(new Date).getTime()},sendMonitoringPixel:function(c){try{this.sendUrlRequest(["//pixel.adsafeprotected.com/mon?anId=10173&campId=",encodeURIComponent(l.getPartnerId()),"&pubId=",encodeURIComponent("vans-js_"+c)].join(""))}catch(b){h.report("smp",b)}},sendUrlRequest:function(c,b){var g,a;if(c){g=this.getWindow();try{a=new g.XMLHttpRequest,b&&(a.onreadystatechange=b),a.open("GET",c),a.send()}catch(e){}}},getWindow:function(){return m.getWin()},
getDocument:function(){return m.getDoc()},generateUID:function(){var c,b="";try{for(c=0;8>c;c++)b=[b,Math.floor(65536*(1+Math.random())).toString(16).substring(1)].join("")}catch(g){}return b},noop:function(){}},h=function(){var c={};return{report:function(b,g){if(!c[b])try{c[b]=!0,k.sendUrlRequest(["//pixel.adsafeprotected.com/jsdiagnostic?code:vans-js_",encodeURIComponent(l.getPartnerId()),"_",b,"&err:",encodeURIComponent(g.message)].join(""))}catch(a){}}}}(),n=function(){var c,b=!1,g=function(e){e==
a()&&(b=!0,p.flushUnsentEvents());return b?"jv3":null},a=function(){c||(c=k.generateUID());return c};return{getVideoId:a,setNodeInterface:function(e){var b,c,f=a();try{b="IASid"+f,c="blockAd"+f,e.className+=" integral-vid-"+f,e[c]=k.noop,e[b]=g,e.getVersion=function(){return"3.3.0"}}catch(r){h.report("sni",r)}},isEstablished:function(){return b},resetHandshake:function(){b=!1}}}(),s=function(){var c,b=function(){var e=function(e){return"undefined"!==typeof e},a=function(){var a="u";try{e(window.opera)&&
e(window.opera.buildNumber)?a="o":e(window.mozInnerScreenY)?a="g":e(window.chrome)&&e(window.chrome.csi)?a="c":e(window.msWriteProfilerMark)&&e(window.crypto)?a="e":e(window.attachEvent)||e(window.msCrypto)?a="i":e(window.WebKitPoint)&&(a="w")}catch(b){}return a}(),b=function(){var a=function(a){for(var b in a)if(a.hasOwnProperty(b)){var c=a[b];""!==c&&"null"!==c&&"undefined"!==c&&null!==c&&e(c)||delete a[b]}return a},b=function(a){var b={},c,d;for(d in a)a.hasOwnProperty(d)&&(c=a[d],e(b[c])?b[c]+=
d:b[c]=d);a={};for(d in b)b.hasOwnProperty(d)&&(c=b[d],a[c]=d);return a};return function(){var c=function(){var a={g:"",q:""};try{a.q=window.parent.parent.parent.parent.parent.parent.parent.parent.parent.parent.location.href}catch(c){var b=c.message,b=b.substring(b.lastIndexOf("<")+1,b.lastIndexOf(">")),d;if(d=e(b))if(d=!1,e(window.navigator)&&e(window.navigator.userAgent)){var f=window.navigator.userAgent.match(/Firefox\/([\.0-9]+)/);null!==f&&2==f.length&&(f=f[1].split("."),3==parseInt(f[0],10)&&
6>=parseInt(f[1],10)&&(3==f.length?13>=parseInt(f[2],10)&&(d=!0):d=!0))}d&&(a.g=b)}return a},d={};try{d.a=encodeURIComponent(top.location.href)}catch(g){}try{d.b=encodeURIComponent(parent.location.href)}catch(h){}if(window!=top){try{d.c=encodeURIComponent(parent.document.referrer)}catch(t){}try{d.e=encodeURIComponent(window.document.referrer)}catch(k){}}try{d.d=encodeURIComponent(window.location.href)}catch(p){}try{var n=c();d.g=encodeURIComponent(n.g);d.q=encodeURIComponent(n.q)}catch(l){}var d=
a(d),d=b(d),c=[],m;for(m in d)d.hasOwnProperty(m)&&c.push({key:m,val:d[m]});c.sort(function(a,b){return a.val.length>b.val.length?1:a.val.length<b.val.length?-1:0});return c}()}();return{br:a,urls:b}},g=function(a,b,c){var f=["//pixel.adsafeprotected.com/db2/video/",b,"/",c,"/skeleton.js?videoId=",n.getVideoId()].join("");b=function(a){f=[f,"&adsafe_url=",a.val,"&adsafe_type=",a.key].join("")};try{a.urls.forEach(b),f=[f,"&adsafe_jsinfo=br:",a.br].join("")}catch(g){h.report("bvu",g)}return f},a=function(){if(4==
this.readyState)if(p.sendPerfSample(40),200==this.status)try{c("failed"===JSON.parse(this.responseText).action?"block":"safe")}catch(a){h.report("ba",a)}else h.report("blk_url_req_err",{message:this.status})};return{init:function(e,d,h){var f=b();p.sendPerfSample(30);e=g(f,e,d);c=h;k.sendUrlRequest(e,a)}}}(),p=function(){var c=[],b=function(a){if(n.isEstablished())try{k.getWindow().postMessage(JSON.stringify(a),"*")}catch(b){h.report("dm",b)}else try{c.push(a)}catch(d){h.report("cm",d)}},g=function(a,
c){try{b({messageType:a,id:n.getVideoId(),time:k.now(),partner:l.getPartnerId(),eventData:c})}catch(d){h.report("se",d)}};return{sendEvent:g,flushUnsentEvents:function(){try{c.forEach(b)}catch(a){h.report("fue",a)}},sendPerfSample:function(a){g("PerfCheckpoint",{type:"vans",code:a,timestamp:k.now()})}}}(),l=function(){var c,b=function(a,b){var c,g=q||"pixel.adsafeprotected.com",f=function(a){var b="";Object.keys(a).forEach(function(c){"advEntityId"!=c&&"pubEntityId"!=c&&"partner"!=c&&(b+="&"+c+"="+
a[c])});return b};try{c=["//",g,a,"?videoId=",n.getVideoId(),f(b)].join("")}catch(k){h.report("bsurl",k)}return c},g=function(a,c,d){var g,f=k.getDocument();try{g=f.createElement("script"),g.src=b(a,c),d.parentNode.appendChild(g)}catch(h){k.sendMonitoringPixel("inj_err")}};return{initCM:function(a,b){if(!a.partner)throw Error("missing partnerId");m.setWin(b);p.sendPerfSample(20);c=a.partner;try{if(!a.anId)throw Error("missing anId");k.sendMonitoringPixel("cminit");n.setNodeInterface(b);g("/jsvid",
a,b)}catch(d){h.report("icm",d)}},initFW:function(a,b,d){var l;if(!a.partner)throw Error("missing partnerId");m.setWin(b);p.sendPerfSample(20);c=a.partner;try{if(!a.advEntityId||!a.pubEntityId)throw Error("missing client id: advEntityId: "+a.advEntityId+" ,pubEntityId: "+a.pubEntityId);k.sendMonitoringPixel("fwinit");d&&s.init(a.advEntityId,a.pubEntityId,d);l="/fwjsvid/st/"+a.advEntityId+"/"+a.pubEntityId+"/skeleton.js";n.setNodeInterface(b);g(l,a,b)}catch(f){h.report("ifw",f)}},getPartnerId:function(){return c}}}(),
m=function(){var c=window;return{getWin:function(){return c},setWin:function(b){(b=b&&b.ownerDocument)&&b.defaultView?c=b.defaultView:b&&b.parentWindow?c=b.parentWindow:h.report("sc",{message:""})},getDoc:function(){return c.document}}}();p.sendPerfSample(10);return{initFW:l.initFW,initCM:l.initCM,sendEvent:p.sendEvent}};
function F(b){function w(d){var c=new google.ima.AdsRenderingSettings;c.bitrate=b.bitrate;c.restoreCustomPlaybackStateOnAdBreakComplete=!0;a=d.getAdsManager(g,c);a.addEventListener(google.ima.AdErrorEvent.Type.AD_ERROR,m);a.addEventListener(google.ima.AdEvent.Type.CONTENT_PAUSE_REQUESTED,q);a.addEventListener(google.ima.AdEvent.Type.CONTENT_RESUME_REQUESTED,t);a.addEventListener(google.ima.AdEvent.Type.ALL_ADS_COMPLETED,h);a.addEventListener(google.ima.AdEvent.Type.LOADED,h);a.addEventListener(google.ima.AdEvent.Type.STARTED,
h);a.addEventListener(google.ima.AdEvent.Type.FIRST_QUARTILE,h);a.addEventListener(google.ima.AdEvent.Type.MIDPOINT,h);a.addEventListener(google.ima.AdEvent.Type.THIRD_QUARTILE,h);a.addEventListener(google.ima.AdEvent.Type.COMPLETE,h);a.addEventListener(google.ima.AdEvent.Type.DURATION_CHANGE,h);a.addEventListener(google.ima.AdEvent.Type.PAUSED,h);a.addEventListener(google.ima.AdEvent.Type.RESUMED,h);a.addEventListener(google.ima.AdEvent.Type.VOLUME_CHANGED,h);a.addEventListener(google.ima.AdEvent.Type.VOLUME_MUTED,
h);a.addEventListener(google.ima.AdEvent.Type.SKIPPED,h);a.addEventListener(google.ima.AdEvent.Type.USER_CLOSE,h);a.addEventListener(google.ima.AdEvent.Type.IMPRESSION,h);a.addEventListener(google.ima.AdEvent.Type.CLICK,h);b.m()}function h(d){var c=d.getAd();if(c&&c.isLinear())switch(d.type){case google.ima.AdEvent.Type.LOADED:n=c;break;case google.ima.AdEvent.Type.STARTED:b.D();k=c.getDuration();b.c();f=setInterval(function(){a.getRemainingTime();if(null!==n){var d=n.getDuration();d!=k&&(k=d,b.c())}},
300);break;case google.ima.AdEvent.Type.FIRST_QUARTILE:b.u();break;case google.ima.AdEvent.Type.MIDPOINT:b.w();break;case google.ima.AdEvent.Type.THIRD_QUARTILE:b.F();break;case google.ima.AdEvent.Type.COMPLETE:clearInterval(f);b.s();break;case google.ima.AdEvent.Type.DURATION_CHANGE:b.c();break;case google.ima.AdEvent.Type.PAUSED:b.A();break;case google.ima.AdEvent.Type.RESUMED:b.B();break;case google.ima.AdEvent.Type.VOLUME_CHANGED:b.H();break;case google.ima.AdEvent.Type.VOLUME_MUTED:b.I();break;
case google.ima.AdEvent.Type.SKIPPED:b.C();break;case google.ima.AdEvent.Type.USER_CLOSE:b.G();break;case google.ima.AdEvent.Type.IMPRESSION:b.v();break;case google.ima.AdEvent.Type.CLICK:b.o()}}function m(d){try{a.destroy()}catch(c){console.log("Error destroying AdsManager")}b.h(d.getError().getMessage())}function q(){}function t(){}var a,l,d,f,g,n,k=-2;this.j=function(){g=b.R;d=new google.ima.AdDisplayContainer(b.P,g);l=new google.ima.AdsLoader(d);l.addEventListener(google.ima.AdsManagerLoadedEvent.Type.ADS_MANAGER_LOADED,
w,!1);l.addEventListener(google.ima.AdErrorEvent.Type.AD_ERROR,m,!1);var a=new google.ima.AdsRequest;a.adsResponse=b.xml;a.linearAdSlotWidth=b.b;a.linearAdSlotHeight=b.a;a.nonLinearAdSlotWidth=b.b;a.nonLinearAdSlotHeight=b.a;l.requestAds(a)};this.K=function(){g.load();d.initialize();try{a.init(b.b,b.a,b.l),a.start()}catch(p){try{a.destroy()}catch(c){}b.h("Failed to start AdsManager")}};this.J=function(){a.pause()};this.M=function(){a.resume()};this.g=function(){return a.getRemainingTime()};this.f=
function(){return k};this.destroy=function(){a.destroy()};this.N=function(d){a.setVolume(d)};this.i=function(){return a.getVolume()};this.L=function(d,b,f){a.resize(d,b,f)};this.getAdSkippableState=function(){return a.getAdSkippableState()};this.O=function(){a.skip()}}
function G(){function b(a){var d=document.getElementsByTagName("head")[0],e=document.createElement("script");e.setAttribute("type","text/javascript");e.setAttribute("src",a);d.appendChild(e)}function w(a){var d="",e="";for(key in a)d+=e,d+=encodeURIComponent(key)+"="+encodeURIComponent(a[key]),e="&";return d}function h(a){try{var e=(new DOMParser).parseFromString(a,"text/xml").getElementsByTagName("CompanionAds");0<e.length&&(A=(new XMLSerializer).serializeToString(e[0]))}catch(I){}g=new F({P:n,R:k,
xml:a,bitrate:B,b:u,a:v,l:x,m:function(){f("AdLoaded")},D:function(){d("Started");f("AdVideoStart");f("AdStarted")},u:function(){f("AdVideoFirstQuartile")},w:function(){f("AdVideoMidpoint")},F:function(){f("AdVideoThirdQuartile")},s:function(){console.log("onComplete");f("AdVideoComplete");m()},c:function(){f("AdDurationChange")},A:function(){f("AdPaused")},B:function(){f("AdPlaying")},H:function(){f("AdVolumeChange")},I:function(){f("AdVolumeChange")},C:function(){f("AdSkipped")},G:function(){f("AdUserClose")},
v:function(){f("AdImpression")},o:function(){f("AdClickThru")},h:function(){f("AdError")}});g.j()}function m(){d("Stopping ad");try{g.destroy()}catch(e){console.log(e)}f("AdStopped")}function q(){d("getAdVolume");return g.i()}function t(){d("getAdSkippableState");return g.getAdSkippableState()}function a(){d("duration = "+g.f());return g.f()}function l(){d("Only Linear Ads supported");return!0}function d(a){C&&console.log(a)}function f(e){d("raising event "+e);if(r){var b=q(),c=a();r.sendEvent(e,
{volume:b,ad_duration:c})}D.push(e);if(b=p[e])for(key in b)if("AdStopped"==e&&console.log("Stopped Key: "+key),c=b[key])d("found callback for "+e),(y||z)&&"AdStopped"==e&&c==E?function(a){setTimeout(function(){console.log("called stop callback (with delay) "+a);a()},1E3)}(c):("AdStopped"==e&&console.log("called stop callback (no delay) "+c),c())}var g=null,n=null,k=null,p={},c={},u=-1,v=-1,B=-1,x=null,r=null,A=null,H=this,D=[],C=!1,z=!1,y=!1,E=null;b("https://imasdk.googleapis.com/js/sdkloader/ima3.js");
this.getAdLinear=this.getAdLinear=l;this.getAdCompanions=function(){return A};this.getAdIcons=function(){d("AdIcons not currently supported");return!1};this.getAdDuration=a;this.getAdRemainingTime=function(){d("remaining time = "+g.g());return g.g()};this.getAdHeight=function(){return v};this.getAdWidth=function(){return u};this.getAdSkippableState=t;this.getAdExpanded=function(){d("getAdExpanded");return!1};this.getAdVolume=q;this.setAdVolume=function(a){d("setAdVolume "+a);g.N(a)};this.unsubscribe=
function(a,b){d("unsubscribe "+b);p[b][a]=null};this.subscribe=function(a,b,c){d("Subscribe for "+b+" - "+a);c=c?a.bind(c):a;var e=p[b];"AdStopped"==b&&console.log("REGISTERING "+a);e||("AdStopped"==b&&(E=c),e=p[b]={});e[a]=c};this.expandAd=function(){d("expandAd (not supported)")};this.collapseAd=function(){d("collapseAd (not supported)")};this.skipAd=function(){d("skipAd");t()&&g.O()};this.resumeAd=function(){d("resumeAd");g.M()};this.pauseAd=function(){d("pauseAd");g.J()};this.resizeAd=function(b,
c,h){d("resizeAd "+b+"x"+c+" "+h);g.L(b,c,h);u=b;v=c;x=h;if(r){var e=q(),k=a();r.sendEvent("resizeAd",{volume:e,ad_duration:k,width:b,height:c,viewMode:h})}f("AdSizeChange")};this.initAd=function(a,g,l,p,m,q){u=a;v=g;B=p;x=l;n=q.slot;k=q.videoSlot;c=JSON.parse(m.AdParameters);C=(m=c.debug)&&"true"==m.toLowerCase();d("initAd "+a+"x"+g+" "+l+" "+p);null===k&&(k=document.createElement("video"),d("Warning: No video element passed to ad, creating element."),n.appendChild(k));(z=c.dvEnabled)&&"true"==z.toLowerCase()&&
(l="dv_callback"+((new Date).getTime()+""+Math.floor(1E7*Math.random())).substr(0,16),window[l]=function(){return H},b("https://cdn.doubleverify.com/dvvid_src.js?"+w({ctx:"499507",cmp:"DV016560",sid:"17306",plc:"201612132",advid:"3065265",adsrv:"27",tagformat:"2",tagtype:"video",dvtagver:"6.1.src",DVP_ADV:c.advertiserId,DVPX_BIDID:c.auctionId,DVP_MM_3:c.strategyId,DVP_MM_4:c.creativeId,DVP_MM_5:c.exchangeId,DVP_GVACB:l})));(y=c.iasEnabled)&&"true"==y.toLowerCase()&&(a={anId:"924937",partner:"MediaMath",
advId:c.campaignId,campId:c.strategyId,pubId:c.exchangeId,chanId:a+"x"+g,placementId:c.creativeId,planId:c.siteId,adsafe_par:"",bundleId:"",uId:c.advertiserId,bidUrl:c.bidUrl,impId:c.auctionId},r=new __IASVANS,r.initCM(a,n));var e=new XMLHttpRequest;e.timeout=2E3;e.onreadystatechange=function(){4==e.readyState&&(null!==e.responseText?h(e.responseText):f("AdError"))};e.ontimeout=function(){f("AdError")};e.open("GET",c.url,!0);e.send()};this.startAd=function(){d("Starting ad");g.K()};this.stopAd=m;
this.handshakeVersion=function(){return"2.0"};this.getPlayer=function(){return k};this.getSlot=function(){return n};this.getPreviousEvents=function(){return D}}window.getVPAIDAd=function(){return new G};
