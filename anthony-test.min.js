//MediaMath VPAID Wrapper v1.0.0
//Copyright 2017 MediaMath All Rights Reserved
var __IASVANS=function(q){var k={now:function(){return(new Date).getTime()},sendMonitoringPixel:function(c){try{this.sendUrlRequest(["//pixel.adsafeprotected.com/mon?anId=10173&campId=",encodeURIComponent(l.getPartnerId()),"&pubId=",encodeURIComponent("vans-js_"+c)].join(""))}catch(b){h.report("smp",b)}},sendUrlRequest:function(c,b){var g,a;if(c){g=this.getWindow();try{a=new g.XMLHttpRequest,b&&(a.onreadystatechange=b),a.open("GET",c),a.send()}catch(e){}}},getWindow:function(){return m.getWin()},
getDocument:function(){return m.getDoc()},generateUID:function(){var c,b="";try{for(c=0;8>c;c++)b=[b,Math.floor(65536*(1+Math.random())).toString(16).substring(1)].join("")}catch(g){}return b},noop:function(){}},h=function(){var c={};return{report:function(b,g){if(!c[b])try{c[b]=!0,k.sendUrlRequest(["//pixel.adsafeprotected.com/jsdiagnostic?code:vans-js_",encodeURIComponent(l.getPartnerId()),"_",b,"&err:",encodeURIComponent(g.message)].join(""))}catch(a){}}}}(),n=function(){var c,b=!1,g=function(e){e==
a()&&(b=!0,p.flushUnsentEvents());return b?"jv3":null},a=function(){c||(c=k.generateUID());return c};return{getVideoId:a,setNodeInterface:function(e){var b,c,f=a();try{b="IASid"+f,c="blockAd"+f,e.className+=" integral-vid-"+f,e[c]=k.noop,e[b]=g,e.getVersion=function(){return"3.3.0"}}catch(r){h.report("sni",r)}},isEstablished:function(){return b},resetHandshake:function(){b=!1}}}(),s=function(){var c,b=function(){var e=function(e){return"undefined"!==typeof e},a=function(){var a="u";try{e(window.opera)&&
e(window.opera.buildNumber)?a="o":e(window.mozInnerScreenY)?a="g":e(window.chrome)&&e(window.chrome.csi)?a="c":e(window.msWriteProfilerMark)&&e(window.crypto)?a="e":e(window.attachEvent)||e(window.msCrypto)?a="i":e(window.WebKitPoint)&&(a="w")}catch(b){}return a}(),b=function(){var a=function(a){for(var b in a)if(a.hasOwnProperty(b)){var c=a[b];""!==c&&"null"!==c&&"undefined"!==c&&null!==c&&e(c)||delete a[b]}return a},b=function(a){var b={},c,d;for(d in a)a.hasOwnProperty(d)&&(c=a[d],e(b[c])?b[c]+=
d:b[c]=d);a={};for(d in b)b.hasOwnProperty(d)&&(c=b[d],a[c]=d);return a};return function(){var c=function(){var a={g:"",q:""};try{a.q=window.parent.parent.parent.parent.parent.parent.parent.parent.parent.parent.location.href}catch(c){var b=c.message,b=b.substring(b.lastIndexOf("<")+1,b.lastIndexOf(">")),d;if(d=e(b))if(d=!1,e(window.navigator)&&e(window.navigator.userAgent)){var f=window.navigator.userAgent.match(/Firefox\/([\.0-9]+)/);null!==f&&2==f.length&&(f=f[1].split("."),3==parseInt(f[0],10)&&
6>=parseInt(f[1],10)&&(3==f.length?13>=parseInt(f[2],10)&&(d=!0):d=!0))}d&&(a.g=b)}return a},d={};try{d.a=encodeURIComponent(top.location.href)}catch(g){}try{d.b=encodeURIComponent(parent.location.href)}catch(h){}if(window!=top){try{d.c=encodeURIComponent(parent.document.referrer)}catch(t){}try{d.e=encodeURIComponent(window.document.referrer)}catch(k){}}try{d.d=encodeURIComponent(window.location.href)}catch(p){}try{var n=c();d.g=encodeURIComponent(n.g);d.q=encodeURIComponent(n.q)}catch(l){}var d=
a(d),d=b(d),c=[],m;for(m in d)d.hasOwnProperty(m)&&c.push({key:m,val:d[m]});c.sort(function(a,b){return a.val.length>b.val.length?1:a.val.length<b.val.length?-1:0});return c}()}();return{br:a,urls:b}},g=function(a,b,c){var f=["//pixel.adsafeprotected.com/db2/video/",b,"/",c,"/skeleton.js?videoId=",n.getVideoId()].join("");b=function(a){f=[f,"&adsafe_url=",a.val,"&adsafe_type=",a.key].join("")};try{a.urls.forEach(b),f=[f,"&adsafe_jsinfo=br:",a.br].join("")}catch(g){h.report("bvu",g)}return f},a=function(){if(4==
this.readyState)if(p.sendPerfSample(40),200==this.status)try{c("failed"===JSON.parse(this.responseText).action?"block":"safe")}catch(a){h.report("ba",a)}else h.report("blk_url_req_err",{message:this.status})};return{init:function(e,d,h){var f=b();p.sendPerfSample(30);e=g(f,e,d);c=h;k.sendUrlRequest(e,a)}}}(),p=function(){var c=[],b=function(a){if(n.isEstablished())try{k.getWindow().postMessage(JSON.stringify(a),"*")}catch(b){h.report("dm",b)}else try{c.push(a)}catch(d){h.report("cm",d)}},g=function(a,
c){try{b({messageType:a,id:n.getVideoId(),time:k.now(),partner:l.getPartnerId(),eventData:c})}catch(d){h.report("se",d)}};return{sendEvent:g,flushUnsentEvents:function(){try{c.forEach(b)}catch(a){h.report("fue",a)}},sendPerfSample:function(a){g("PerfCheckpoint",{type:"vans",code:a,timestamp:k.now()})}}}(),l=function(){var c,b=function(a,b){var c,g=q||"pixel.adsafeprotected.com",f=function(a){var b="";Object.keys(a).forEach(function(c){"advEntityId"!=c&&"pubEntityId"!=c&&"partner"!=c&&(b+="&"+c+"="+
a[c])});return b};try{c=["//",g,a,"?videoId=",n.getVideoId(),f(b)].join("")}catch(k){h.report("bsurl",k)}return c},g=function(a,c,d){var g,f=k.getDocument();try{g=f.createElement("script"),g.src=b(a,c),d.parentNode.appendChild(g)}catch(h){k.sendMonitoringPixel("inj_err")}};return{initCM:function(a,b){if(!a.partner)throw Error("missing partnerId");m.setWin(b);p.sendPerfSample(20);c=a.partner;try{if(!a.anId)throw Error("missing anId");k.sendMonitoringPixel("cminit");n.setNodeInterface(b);g("/jsvid",
a,b)}catch(d){h.report("icm",d)}},initFW:function(a,b,d){var l;if(!a.partner)throw Error("missing partnerId");m.setWin(b);p.sendPerfSample(20);c=a.partner;try{if(!a.advEntityId||!a.pubEntityId)throw Error("missing client id: advEntityId: "+a.advEntityId+" ,pubEntityId: "+a.pubEntityId);k.sendMonitoringPixel("fwinit");d&&s.init(a.advEntityId,a.pubEntityId,d);l="/fwjsvid/st/"+a.advEntityId+"/"+a.pubEntityId+"/skeleton.js";n.setNodeInterface(b);g(l,a,b)}catch(f){h.report("ifw",f)}},getPartnerId:function(){return c}}}(),
m=function(){var c=window;return{getWin:function(){return c},setWin:function(b){(b=b&&b.ownerDocument)&&b.defaultView?c=b.defaultView:b&&b.parentWindow?c=b.parentWindow:h.report("sc",{message:""})},getDoc:function(){return c.document}}}();p.sendPerfSample(10);return{initFW:l.initFW,initCM:l.initCM,sendEvent:p.sendEvent}};
function F(b){function w(c){var d=new google.ima.AdsRenderingSettings;d.bitrate=b.bitrate;d.restoreCustomPlaybackStateOnAdBreakComplete=!0;a=c.getAdsManager(g,d);a.addEventListener(google.ima.AdErrorEvent.Type.AD_ERROR,m);a.addEventListener(google.ima.AdEvent.Type.CONTENT_PAUSE_REQUESTED,q);a.addEventListener(google.ima.AdEvent.Type.CONTENT_RESUME_REQUESTED,t);a.addEventListener(google.ima.AdEvent.Type.ALL_ADS_COMPLETED,h);a.addEventListener(google.ima.AdEvent.Type.LOADED,h);a.addEventListener(google.ima.AdEvent.Type.STARTED,
h);a.addEventListener(google.ima.AdEvent.Type.FIRST_QUARTILE,h);a.addEventListener(google.ima.AdEvent.Type.MIDPOINT,h);a.addEventListener(google.ima.AdEvent.Type.THIRD_QUARTILE,h);a.addEventListener(google.ima.AdEvent.Type.COMPLETE,h);a.addEventListener(google.ima.AdEvent.Type.DURATION_CHANGE,h);a.addEventListener(google.ima.AdEvent.Type.PAUSED,h);a.addEventListener(google.ima.AdEvent.Type.RESUMED,h);a.addEventListener(google.ima.AdEvent.Type.VOLUME_CHANGED,h);a.addEventListener(google.ima.AdEvent.Type.VOLUME_MUTED,
h);a.addEventListener(google.ima.AdEvent.Type.SKIPPED,h);a.addEventListener(google.ima.AdEvent.Type.USER_CLOSE,h);a.addEventListener(google.ima.AdEvent.Type.IMPRESSION,h);a.addEventListener(google.ima.AdEvent.Type.CLICK,h);b.m()}function h(c){var d=c.getAd();if(d&&d.isLinear())switch(c.type){case google.ima.AdEvent.Type.LOADED:n=d;break;case google.ima.AdEvent.Type.STARTED:b.D();k=d.getDuration();b.c();e=setInterval(function(){a.getRemainingTime();if(null!==n){var c=n.getDuration();c!=k&&(k=c,b.c())}},
300);break;case google.ima.AdEvent.Type.FIRST_QUARTILE:b.u();break;case google.ima.AdEvent.Type.MIDPOINT:b.w();break;case google.ima.AdEvent.Type.THIRD_QUARTILE:b.F();break;case google.ima.AdEvent.Type.COMPLETE:clearInterval(e);b.s();break;case google.ima.AdEvent.Type.DURATION_CHANGE:b.c();break;case google.ima.AdEvent.Type.PAUSED:b.A();break;case google.ima.AdEvent.Type.RESUMED:b.B();break;case google.ima.AdEvent.Type.VOLUME_CHANGED:b.H();break;case google.ima.AdEvent.Type.VOLUME_MUTED:b.I();break;
case google.ima.AdEvent.Type.SKIPPED:b.C();break;case google.ima.AdEvent.Type.USER_CLOSE:b.G();break;case google.ima.AdEvent.Type.IMPRESSION:b.v();break;case google.ima.AdEvent.Type.CLICK:b.o()}}function m(c){try{a.destroy()}catch(d){console.log("Error destroying AdsManager")}b.h(c.getError().getMessage())}function q(){}function t(){}var a,l,c,e,g,n,k=-2;this.j=function(){g=b.R;c=new google.ima.AdDisplayContainer(b.P,g);l=new google.ima.AdsLoader(c);l.addEventListener(google.ima.AdsManagerLoadedEvent.Type.ADS_MANAGER_LOADED,
w,!1);l.addEventListener(google.ima.AdErrorEvent.Type.AD_ERROR,m,!1);var a=new google.ima.AdsRequest;a.adsResponse=b.xml;a.linearAdSlotWidth=b.b;a.linearAdSlotHeight=b.a;a.nonLinearAdSlotWidth=b.b;a.nonLinearAdSlotHeight=b.a;l.requestAds(a)};this.K=function(){g.load();c.initialize();try{a.init(b.b,b.a,b.l),a.start()}catch(p){try{a.destroy()}catch(d){}b.h("Failed to start AdsManager")}};this.J=function(){a.pause()};this.M=function(){a.resume()};this.g=function(){return a.getRemainingTime()};this.f=
function(){return k};this.destroy=function(){a.destroy()};this.N=function(c){a.setVolume(c)};this.i=function(){return a.getVolume()};this.L=function(c,b,e){a.resize(c,b,e)};this.getAdSkippableState=function(){return a.getAdSkippableState()};this.O=function(){a.skip()}}
function G(){function b(a){var c=document.getElementsByTagName("head")[0],f=document.createElement("script");f.setAttribute("type","text/javascript");f.setAttribute("src",a);c.appendChild(f)}function w(a){var c="",f="";for(key in a)c+=f,c+=encodeURIComponent(key)+"="+encodeURIComponent(a[key]),f="&";return c}function h(a){try{var f=(new DOMParser).parseFromString(a,"text/xml").getElementsByTagName("CompanionAds");0<f.length&&(A=(new XMLSerializer).serializeToString(f[0]))}catch(I){}g=new F({P:n,R:k,
xml:a,bitrate:B,b:u,a:v,l:x,m:function(){e("AdLoaded")},D:function(){c("Started");e("AdVideoStart");e("AdStarted")},u:function(){e("AdVideoFirstQuartile")},w:function(){e("AdVideoMidpoint")},F:function(){e("AdVideoThirdQuartile")},s:function(){console.log("onComplete");e("AdVideoComplete");m()},c:function(){e("AdDurationChange")},A:function(){e("AdPaused")},B:function(){e("AdPlaying")},H:function(){e("AdVolumeChange")},I:function(){e("AdVolumeChange")},C:function(){e("AdSkipped")},G:function(){e("AdUserClose")},
v:function(){e("AdImpression")},o:function(){e("AdClickThru")},h:function(){e("AdError")}});g.j()}function m(){c("Stopping ad");try{g.destroy()}catch(f){console.log(f)}e("AdStopped")}function q(){c("getAdVolume");return g.i()}function t(){c("getAdSkippableState");return g.getAdSkippableState()}function a(){c("duration = "+g.f());return g.f()}function l(){c("Only Linear Ads supported");return!0}function c(a){C&&console.log(a)}function e(f){c("raising event "+f);if(r){var b=q(),d=a();r.sendEvent(f,
{volume:b,ad_duration:d})}D.push(f);if(b=p[f])for(key in b=b.reverse(),b){var e=b[key];e&&(c("found callback for "+f),(y||z)&&"AdStopped"==f&&e==E?setTimeout(function(){console.log("called stop callback");e()},1E3):e())}}var g=null,n=null,k=null,p={},d={},u=-1,v=-1,B=-1,x=null,r=null,A=null,H=this,D=[],C=!1,z=!1,y=!1,E=null;b("https://imasdk.googleapis.com/js/sdkloader/ima3.js");this.getAdLinear=this.getAdLinear=l;this.getAdCompanions=function(){return A};this.getAdIcons=function(){c("AdIcons not currently supported");
return!1};this.getAdDuration=a;this.getAdRemainingTime=function(){c("remaining time = "+g.g());return g.g()};this.getAdHeight=function(){return v};this.getAdWidth=function(){return u};this.getAdSkippableState=t;this.getAdExpanded=function(){c("getAdExpanded");return!1};this.getAdVolume=q;this.setAdVolume=function(a){c("setAdVolume "+a);g.N(a)};this.unsubscribe=function(a,b){c("unsubscribe "+b);p[b][a]=null};this.subscribe=function(a,b,d){c("Subscribe for "+b+" - "+a);d=d?a.bind(d):a;var e=p[b];e||
("AdStopped"==eventType&&(E=d),e=p[b]={});e[a]=d};this.expandAd=function(){c("expandAd (not supported)")};this.collapseAd=function(){c("collapseAd (not supported)")};this.skipAd=function(){c("skipAd");t()&&g.O()};this.resumeAd=function(){c("resumeAd");g.M()};this.pauseAd=function(){c("pauseAd");g.J()};this.resizeAd=function(b,d,h){c("resizeAd "+b+"x"+d+" "+h);g.L(b,d,h);u=b;v=d;x=h;if(r){var f=q(),k=a();r.sendEvent("resizeAd",{volume:f,ad_duration:k,width:b,height:d,viewMode:h})}e("AdSizeChange")};
this.initAd=function(a,g,l,p,m,q){u=a;v=g;B=p;x=l;n=q.slot;k=q.videoSlot;d=JSON.parse(m.AdParameters);C=(m=d.debug)&&"true"==m.toLowerCase();c("initAd "+a+"x"+g+" "+l+" "+p);null===k&&(k=document.createElement("video"),c("Warning: No video element passed to ad, creating element."),n.appendChild(k));(z=d.dvEnabled)&&"true"==z.toLowerCase()&&(l="dv_callback"+((new Date).getTime()+""+Math.floor(1E7*Math.random())).substr(0,16),window[l]=function(){return H},b("https://cdn.doubleverify.com/dvvid_src.js?"+
w({ctx:"499507",cmp:"DV016560",sid:"17306",plc:"201612132",advid:"3065265",adsrv:"27",tagformat:"2",tagtype:"video",dvtagver:"6.1.src",DVP_ADV:d.advertiserId,DVPX_BIDID:d.auctionId,DVP_MM_3:d.strategyId,DVP_MM_4:d.creativeId,DVP_MM_5:d.exchangeId,DVP_GVACB:l})));(y=d.iasEnabled)&&"true"==y.toLowerCase()&&(a={anId:"924937",partner:"MediaMath",advId:d.campaignId,campId:d.strategyId,pubId:d.exchangeId,chanId:a+"x"+g,placementId:d.creativeId,planId:d.siteId,adsafe_par:"",bundleId:"",uId:d.advertiserId,
bidUrl:d.bidUrl,impId:d.auctionId},r=new __IASVANS,r.initCM(a,n));var f=new XMLHttpRequest;f.timeout=2E3;f.onreadystatechange=function(){4==f.readyState&&(null!==f.responseText?h(f.responseText):e("AdError"))};f.ontimeout=function(){e("AdError")};f.open("GET",d.url,!0);f.send()};this.startAd=function(){c("Starting ad");g.K()};this.stopAd=m;this.handshakeVersion=function(){return"2.0"};this.getPlayer=function(){return k};this.getSlot=function(){return n};this.getPreviousEvents=function(){return D}}
window.getVPAIDAd=function(){return new G};
