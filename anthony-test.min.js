//MediaMath VPAID Wrapper v1.0.0
//Copyright 2017 MediaMath All Rights Reserved
var __IASVANS=function(q){var k={now:function(){return(new Date).getTime()},sendMonitoringPixel:function(c){try{this.sendUrlRequest(["//pixel.adsafeprotected.com/mon?anId=10173&campId=",encodeURIComponent(l.getPartnerId()),"&pubId=",encodeURIComponent("vans-js_"+c)].join(""))}catch(b){h.report("smp",b)}},sendUrlRequest:function(c,b){var g,a;if(c){g=this.getWindow();try{a=new g.XMLHttpRequest,b&&(a.onreadystatechange=b),a.open("GET",c),a.send()}catch(e){}}},getWindow:function(){return m.getWin()},
getDocument:function(){return m.getDoc()},generateUID:function(){var c,b="";try{for(c=0;8>c;c++)b=[b,Math.floor(65536*(1+Math.random())).toString(16).substring(1)].join("")}catch(g){}return b},noop:function(){}},h=function(){var c={};return{report:function(b,g){if(!c[b])try{c[b]=!0,k.sendUrlRequest(["//pixel.adsafeprotected.com/jsdiagnostic?code:vans-js_",encodeURIComponent(l.getPartnerId()),"_",b,"&err:",encodeURIComponent(g.message)].join(""))}catch(a){}}}}(),n=function(){var c,b=!1,g=function(e){e==
a()&&(b=!0,p.flushUnsentEvents());return b?"jv3":null},a=function(){c||(c=k.generateUID());return c};return{getVideoId:a,setNodeInterface:function(e){var b,c,f=a();try{b="IASid"+f,c="blockAd"+f,e.className+=" integral-vid-"+f,e[c]=k.noop,e[b]=g,e.getVersion=function(){return"3.3.0"}}catch(r){h.report("sni",r)}},isEstablished:function(){return b},resetHandshake:function(){b=!1}}}(),s=function(){var c,b=function(){var e=function(e){return"undefined"!==typeof e},a=function(){var a="u";try{e(window.opera)&&
e(window.opera.buildNumber)?a="o":e(window.mozInnerScreenY)?a="g":e(window.chrome)&&e(window.chrome.csi)?a="c":e(window.msWriteProfilerMark)&&e(window.crypto)?a="e":e(window.attachEvent)||e(window.msCrypto)?a="i":e(window.WebKitPoint)&&(a="w")}catch(b){}return a}(),b=function(){var a=function(a){for(var b in a)if(a.hasOwnProperty(b)){var c=a[b];""!==c&&"null"!==c&&"undefined"!==c&&null!==c&&e(c)||delete a[b]}return a},b=function(a){var b={},c,d;for(d in a)a.hasOwnProperty(d)&&(c=a[d],e(b[c])?b[c]+=
d:b[c]=d);a={};for(d in b)b.hasOwnProperty(d)&&(c=b[d],a[c]=d);return a};return function(){var c=function(){var a={g:"",q:""};try{a.q=window.parent.parent.parent.parent.parent.parent.parent.parent.parent.parent.location.href}catch(c){var b=c.message,b=b.substring(b.lastIndexOf("<")+1,b.lastIndexOf(">")),d;if(d=e(b))if(d=!1,e(window.navigator)&&e(window.navigator.userAgent)){var f=window.navigator.userAgent.match(/Firefox\/([\.0-9]+)/);null!==f&&2==f.length&&(f=f[1].split("."),3==parseInt(f[0],10)&&
6>=parseInt(f[1],10)&&(3==f.length?13>=parseInt(f[2],10)&&(d=!0):d=!0))}d&&(a.g=b)}return a},d={};try{d.a=encodeURIComponent(top.location.href)}catch(g){}try{d.b=encodeURIComponent(parent.location.href)}catch(h){}if(window!=top){try{d.c=encodeURIComponent(parent.document.referrer)}catch(t){}try{d.e=encodeURIComponent(window.document.referrer)}catch(k){}}try{d.d=encodeURIComponent(window.location.href)}catch(p){}try{var n=c();d.g=encodeURIComponent(n.g);d.q=encodeURIComponent(n.q)}catch(l){}var d=
a(d),d=b(d),c=[],m;for(m in d)d.hasOwnProperty(m)&&c.push({key:m,val:d[m]});c.sort(function(a,b){return a.val.length>b.val.length?1:a.val.length<b.val.length?-1:0});return c}()}();return{br:a,urls:b}},g=function(a,b,c){var f=["//pixel.adsafeprotected.com/db2/video/",b,"/",c,"/skeleton.js?videoId=",n.getVideoId()].join("");b=function(a){f=[f,"&adsafe_url=",a.val,"&adsafe_type=",a.key].join("")};try{a.urls.forEach(b),f=[f,"&adsafe_jsinfo=br:",a.br].join("")}catch(g){h.report("bvu",g)}return f},a=function(){if(4==
this.readyState)if(p.sendPerfSample(40),200==this.status)try{c("failed"===JSON.parse(this.responseText).action?"block":"safe")}catch(a){h.report("ba",a)}else h.report("blk_url_req_err",{message:this.status})};return{init:function(e,d,h){var f=b();p.sendPerfSample(30);e=g(f,e,d);c=h;k.sendUrlRequest(e,a)}}}(),p=function(){var c=[],b=function(a){if(n.isEstablished())try{k.getWindow().postMessage(JSON.stringify(a),"*")}catch(b){h.report("dm",b)}else try{c.push(a)}catch(d){h.report("cm",d)}},g=function(a,
c){try{b({messageType:a,id:n.getVideoId(),time:k.now(),partner:l.getPartnerId(),eventData:c})}catch(d){h.report("se",d)}};return{sendEvent:g,flushUnsentEvents:function(){try{c.forEach(b)}catch(a){h.report("fue",a)}},sendPerfSample:function(a){g("PerfCheckpoint",{type:"vans",code:a,timestamp:k.now()})}}}(),l=function(){var c,b=function(a,b){var c,g=q||"pixel.adsafeprotected.com",f=function(a){var b="";Object.keys(a).forEach(function(c){"advEntityId"!=c&&"pubEntityId"!=c&&"partner"!=c&&(b+="&"+c+"="+
a[c])});return b};try{c=["//",g,a,"?videoId=",n.getVideoId(),f(b)].join("")}catch(k){h.report("bsurl",k)}return c},g=function(a,c,d){var g,f=k.getDocument();try{g=f.createElement("script"),g.src=b(a,c),d.parentNode.appendChild(g)}catch(h){k.sendMonitoringPixel("inj_err")}};return{initCM:function(a,b){if(!a.partner)throw Error("missing partnerId");m.setWin(b);p.sendPerfSample(20);c=a.partner;try{if(!a.anId)throw Error("missing anId");k.sendMonitoringPixel("cminit");n.setNodeInterface(b);g("/jsvid",
a,b)}catch(d){h.report("icm",d)}},initFW:function(a,b,d){var l;if(!a.partner)throw Error("missing partnerId");m.setWin(b);p.sendPerfSample(20);c=a.partner;try{if(!a.advEntityId||!a.pubEntityId)throw Error("missing client id: advEntityId: "+a.advEntityId+" ,pubEntityId: "+a.pubEntityId);k.sendMonitoringPixel("fwinit");d&&s.init(a.advEntityId,a.pubEntityId,d);l="/fwjsvid/st/"+a.advEntityId+"/"+a.pubEntityId+"/skeleton.js";n.setNodeInterface(b);g(l,a,b)}catch(f){h.report("ifw",f)}},getPartnerId:function(){return c}}}(),
m=function(){var c=window;return{getWin:function(){return c},setWin:function(b){(b=b&&b.ownerDocument)&&b.defaultView?c=b.defaultView:b&&b.parentWindow?c=b.parentWindow:h.report("sc",{message:""})},getDoc:function(){return c.document}}}();p.sendPerfSample(10);return{initFW:l.initFW,initCM:l.initCM,sendEvent:p.sendEvent}};
function G(c){function y(d){var k=new google.ima.AdsRenderingSettings;k.bitrate=c.bitrate;k.restoreCustomPlaybackStateOnAdBreakComplete=!0;a=d.getAdsManager(b,k);a.addEventListener(google.ima.AdErrorEvent.Type.AD_ERROR,t);a.addEventListener(google.ima.AdEvent.Type.CONTENT_PAUSE_REQUESTED,u);a.addEventListener(google.ima.AdEvent.Type.CONTENT_RESUME_REQUESTED,p);a.addEventListener(google.ima.AdEvent.Type.ALL_ADS_COMPLETED,g);a.addEventListener(google.ima.AdEvent.Type.LOADED,g);a.addEventListener(google.ima.AdEvent.Type.STARTED,
g);a.addEventListener(google.ima.AdEvent.Type.FIRST_QUARTILE,g);a.addEventListener(google.ima.AdEvent.Type.MIDPOINT,g);a.addEventListener(google.ima.AdEvent.Type.THIRD_QUARTILE,g);a.addEventListener(google.ima.AdEvent.Type.COMPLETE,g);a.addEventListener(google.ima.AdEvent.Type.DURATION_CHANGE,g);a.addEventListener(google.ima.AdEvent.Type.PAUSED,g);a.addEventListener(google.ima.AdEvent.Type.RESUMED,g);a.addEventListener(google.ima.AdEvent.Type.VOLUME_CHANGED,g);a.addEventListener(google.ima.AdEvent.Type.VOLUME_MUTED,
g);a.addEventListener(google.ima.AdEvent.Type.SKIPPED,g);a.addEventListener(google.ima.AdEvent.Type.USER_CLOSE,g);a.addEventListener(google.ima.AdEvent.Type.IMPRESSION,g);a.addEventListener(google.ima.AdEvent.Type.CLICK,g);c.m()}function g(k){var b=k.getAd();if(b&&b.isLinear())switch(k.type){case google.ima.AdEvent.Type.LOADED:e=b;break;case google.ima.AdEvent.Type.STARTED:c.D();n=b.getDuration();c.c();d=setInterval(function(){a.getRemainingTime();if(null!==e){var b=e.getDuration();b!=n&&(n=b,c.c())}},
300);break;case google.ima.AdEvent.Type.FIRST_QUARTILE:c.u();break;case google.ima.AdEvent.Type.MIDPOINT:c.w();break;case google.ima.AdEvent.Type.THIRD_QUARTILE:c.F();break;case google.ima.AdEvent.Type.COMPLETE:clearInterval(d);c.s();break;case google.ima.AdEvent.Type.DURATION_CHANGE:c.c();break;case google.ima.AdEvent.Type.PAUSED:c.A();break;case google.ima.AdEvent.Type.RESUMED:c.B();break;case google.ima.AdEvent.Type.VOLUME_CHANGED:c.H();break;case google.ima.AdEvent.Type.VOLUME_MUTED:c.I();break;
case google.ima.AdEvent.Type.SKIPPED:c.C();break;case google.ima.AdEvent.Type.USER_CLOSE:c.G();break;case google.ima.AdEvent.Type.IMPRESSION:c.v();break;case google.ima.AdEvent.Type.CLICK:c.o()}}function t(b){try{a.destroy()}catch(m){console.log("Error destroying AdsManager")}c.h(b.getError().getMessage())}function u(){}function p(){}var a,l,r,d,b,e,n=-2;this.j=function(){b=c.R;r=new google.ima.AdDisplayContainer(c.P,b);l=new google.ima.AdsLoader(r);l.addEventListener(google.ima.AdsManagerLoadedEvent.Type.ADS_MANAGER_LOADED,
y,!1);l.addEventListener(google.ima.AdErrorEvent.Type.AD_ERROR,t,!1);var a=new google.ima.AdsRequest;a.adsResponse=c.xml;a.linearAdSlotWidth=c.b;a.linearAdSlotHeight=c.a;a.nonLinearAdSlotWidth=c.b;a.nonLinearAdSlotHeight=c.a;l.requestAds(a)};this.K=function(){b.load();r.initialize();try{a.init(c.b,c.a,c.l),a.start()}catch(k){try{a.destroy()}catch(m){}c.h("Failed to start AdsManager")}};this.J=function(){a.pause()};this.M=function(){a.resume()};this.g=function(){return a.getRemainingTime()};this.f=
function(){return n};this.destroy=function(){a.destroy()};this.N=function(b){a.setVolume(b)};this.i=function(){return a.getVolume()};this.L=function(b,c,d){a.resize(b,c,d)};this.getAdSkippableState=function(){return a.getAdSkippableState()};this.O=function(){a.skip()}}
function H(){function c(f,a){var b=document.getElementsByTagName("head")[0],c=document.createElement("script");c.setAttribute("type","text/javascript");c.setAttribute("src",f);c.S=function(){d("loaded "+f);a()};b.appendChild(c)}function y(){var f=new XMLHttpRequest;f.timeout=2E3;f.onreadystatechange=function(){4==f.readyState&&(null!==f.responseText?t(f.responseText):b("AdError"))};f.ontimeout=function(){b("AdError")};f.open("GET",h.url,!0);f.send()}function g(f){var a="",b="";for(key in f)a+=b,a+=
encodeURIComponent(key)+"="+encodeURIComponent(f[key]),b="&";return a}function t(a){try{var f=(new DOMParser).parseFromString(a,"text/xml").getElementsByTagName("CompanionAds");0<f.length&&(console.log("got companion ads "+f),v=(new XMLSerializer).serializeToString(f[0]),console.log(v))}catch(J){}e=new G({P:n,R:k,xml:a,bitrate:C,b:w,a:x,l:z,m:function(){b("AdLoaded")},D:function(){d("Started");b("AdVideoStart");b("AdStarted")},u:function(){b("AdVideoFirstQuartile")},w:function(){b("AdVideoMidpoint")},
F:function(){b("AdVideoThirdQuartile")},s:function(){b("AdVideoComplete");u()},c:function(){b("AdDurationChange")},A:function(){b("AdPaused")},B:function(){b("AdPlaying")},H:function(){b("AdVolumeChange")},I:function(){b("AdVolumeChange")},C:function(){b("AdSkipped")},G:function(){b("AdUserClose")},v:function(){b("AdImpression")},o:function(){b("AdClickThru")},h:function(){b("AdError")}});e.j()}function u(){d("Stopping ad");try{e.destroy()}catch(f){}b("AdStopped")}function p(){d("getAdVolume");return e.i()}
function a(){d("getAdSkippableState");return e.getAdSkippableState()}function l(){d("duration = "+e.f());return e.f()}function r(){d("Only Linear Ads supported");return!0}function d(a){D&&console.log(a)}function b(a){d("raising event "+a);if(q){var b=p(),c=l();q.sendEvent(a,{volume:b,ad_duration:c})}E.push(a);if(b=m[a])for(key in b)if(c=b[key])d("found callback for "+a),(A||B)&&"AdStopped"==a&&c==F?function(a){setTimeout(function(){d("calling stop callback (after delay) "+a);a()},1E3)}(c):("AdStopped"==
a&&d("calling stop callback (no delay) "+c),c())}var e=null,n=null,k=null,m={},h={},w=-1,x=-1,C=-1,z=null,q=null,v=null,I=this,E=[],D=!1,B=!1,A=!1,F=null;this.getAdLinear=this.getAdLinear=r;this.getAdCompanions=function(){console.log("get companions "+v);return v};this.getAdIcons=function(){d("AdIcons not currently supported");return!1};this.getAdDuration=l;this.getAdRemainingTime=function(){d("remaining time = "+e.g());return e.g()};this.getAdHeight=function(){return x};this.getAdWidth=function(){return w};
this.getAdSkippableState=a;this.getAdExpanded=function(){d("getAdExpanded");return!1};this.getAdVolume=p;this.setAdVolume=function(a){d("setAdVolume "+a);e.N(a)};this.unsubscribe=function(a,b){d("unsubscribe "+b);m[b][a]=null};this.subscribe=function(a,b,c){d("Subscribe for "+b+" - "+a);c=c?a.bind(c):a;var f=m[b];f||("AdStopped"==b&&(F=c),f=m[b]={});f[a]=c};this.expandAd=function(){d("expandAd (not supported)")};this.collapseAd=function(){d("collapseAd (not supported)")};this.skipAd=function(){d("skipAd");
a()&&e.O()};this.resumeAd=function(){d("resumeAd");e.M()};this.pauseAd=function(){d("pauseAd");e.J()};this.resizeAd=function(a,c,g){d("resizeAd "+a+"x"+c+" "+g);e.L(a,c,g);w=a;x=c;z=g;if(q){var f=p(),h=l();q.sendEvent("resizeAd",{volume:f,ad_duration:h,width:a,height:c,viewMode:g})}b("AdSizeChange")};this.initAd=function(a,b,e,l,m,p){w=a;x=b;C=l;z=e;n=p.slot;k=p.videoSlot;h=JSON.parse(m.AdParameters);D=(m=h.debug)&&"true"==m.toLowerCase();d("initAd "+a+"x"+b+" "+e+" "+l);null===k&&(k=document.createElement("video"),
d("Warning: No video element passed to ad, creating element."),n.appendChild(k));(B=h.dvEnabled)&&"true"==B.toLowerCase()&&(e="dv_callback"+((new Date).getTime()+""+Math.floor(1E7*Math.random())).substr(0,16),window[e]=function(){return I},c("https://cdn.doubleverify.com/dvvid_src.js?"+g({ctx:"499507",cmp:"DV016560",sid:"17306",plc:"201612132",advid:"3065265",adsrv:"27",tagformat:"2",tagtype:"video",dvtagver:"6.1.src",DVP_ADV:h.advertiserId,DVPX_BIDID:h.auctionId,DVP_MM_3:h.strategyId,DVP_MM_4:h.creativeId,
DVP_MM_5:h.exchangeId,DVP_GVACB:e})));(A=h.iasEnabled)&&"true"==A.toLowerCase()&&(a={anId:"924937",partner:"MediaMath",advId:h.campaignId,campId:h.strategyId,pubId:h.exchangeId,chanId:a+"x"+b,placementId:h.creativeId,planId:h.siteId,adsafe_par:"",bundleId:"",uId:h.advertiserId,bidUrl:h.bidUrl,impId:h.auctionId},q=new __IASVANS,q.initCM(a,n));c("https://imasdk.googleapis.com/js/sdkloader/ima3.js",y)};this.startAd=function(){d("Starting ad");e.K()};this.stopAd=u;this.handshakeVersion=function(){return"2.0"};
this.getPlayer=function(){return k};this.getSlot=function(){return n};this.getPreviousEvents=function(){return E}}window.getVPAIDAd=function(){return new H};
